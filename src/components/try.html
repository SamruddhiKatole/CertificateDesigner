<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Certificate Renderer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div id="certificate-container" style="width: 800px; height: 1131px; position: relative; overflow: hidden;">
    <img id="certificate-bg" 
     src="https://truscholar-assets-public.s3.ap-south-1.amazonaws.com/certificateeditor/background/a4portrait/bg1.png" 
     style="position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 0;" 
     crossorigin="anonymous" />

  </div>
  <button onclick="downloadCertificate()">Download</button>

  <script>
    const templateJson = {
      "rndElemSet": {
        "697695354": {
          "elementType": "IMAGE",
          "rndProps": { "position": { "x": 299, "y": 82 }, "size": { "width": 100, "height": 100 } },
          "imgUrl": "https://truscholar-assets-public.s3.ap-south-1.amazonaws.com/certificateeditor/images/badge1.png"
        },
        "9540179518": {
          "elementType": "TEXT",
          "rndProps": { "position": { "x": 131, "y": 323 }, "size": { "width": 150, "height": 40 } },
          "html": "Testing",
          "textStyle": { "fontWeight": 900, "fontStyle": "italic", "fontFamily": "Roboto", "color": "#C30606", "fontSize": "20px" }
        },
        "6254074588": {
          "elementType": "VARIABLE",
          "rndProps": { "position": { "x": 85, "y": 225 }, "size": { "width": 150, "height": 40 } },
          "html": "{{OrgName}}",
          "textStyle": { "fontWeight": 400, "fontStyle": "normal", "fontFamily": "Roboto", "color": "#000000", "fontSize": "20px" }
        }
      }
    };

    function renderCertificate() {
      const container = document.getElementById("certificate-container");

      Object.values(templateJson.rndElemSet).forEach(element => {
        const elemDiv = document.createElement("div");
        elemDiv.style.position = "absolute";
        elemDiv.style.left = element.rndProps.position.x + "px";
        elemDiv.style.top = element.rndProps.position.y + "px";
        elemDiv.style.width = element.rndProps.size.width + "px";
        elemDiv.style.height = element.rndProps.size.height + "px";
        elemDiv.style.textAlign = "center";

        if (element.elementType === "TEXT" || element.elementType === "VARIABLE") {
          elemDiv.innerHTML = element.html;
          Object.assign(elemDiv.style, element.textStyle);
        } else if (element.elementType === "IMAGE") {
          const img = document.createElement("img");
          img.src = element.imgUrl;
          img.style.width = "100%";
          img.style.height = "100%";
          img.crossOrigin = "anonymous";  // Ensure CORS is enabled for this image
          elemDiv.appendChild(img);
        }

        container.appendChild(elemDiv);
      });
    }

    function downloadCertificate() {
      const container = document.getElementById("certificate-container");

      html2canvas(container, {
        useCORS: true,
        scale: 2,
        logging: true  // Enable logging for debugging purposes
      }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jspdf.jsPDF("p", "mm", "a4");
        pdf.addImage(imgData, "PNG", 0, 0, 210, 297);
        pdf.save("certificate.pdf");
      }).catch(error => {
        console.error("Error capturing the certificate:", error);
      });
    }

    renderCertificate();
  </script>
</body>
</html>
